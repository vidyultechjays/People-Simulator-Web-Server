{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Emotional Impact Results</title>
    <link rel="stylesheet" href="{% static 'css/results_style.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Emotional Impact Results</h1>
    
    <div class="news-content">
        <h2>News Item</h2>
        <p id="news-text">{{ news_content }}</p>
    </div>

    <div class="emotion-summary">
        <h2>Emotional Response Summary</h2>
        <canvas id="emotionChart"></canvas>
        
        <div class="summary-details">
            <p>Positive: <span id="positive-percent">0%</span></p>
            <p>Negative: <span id="negative-percent">0%</span></p>
            <p>Neutral: <span id="neutral-percent">0%</span></p>
            <p>Total Responses: <span id="total-responses">0</span></p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/aggregate-impact/?news_content=' + encodeURIComponent('{{ news_content }}'))
                .then(response => response.json())
                .then(data => {
                    // Update percentages
                    document.getElementById('positive-percent').textContent = data.summary.positive + '%';
                    document.getElementById('negative-percent').textContent = data.summary.negative + '%';
                    document.getElementById('neutral-percent').textContent = data.summary.neutral + '%';
                    document.getElementById('total-responses').textContent = data.total_responses;

                    // Create Chart
                    var ctx = document.getElementById('emotionChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: ['Positive', 'Negative', 'Neutral'],
                            datasets: [{
                                data: [
                                    data.summary.positive, 
                                    data.summary.negative, 
                                    data.summary.neutral
                                ],
                                backgroundColor: [
                                    'rgba(75, 192, 192, 0.6)',
                                    'rgba(255, 99, 132, 0.6)',
                                    'rgba(201, 203, 207, 0.6)'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            title: {
                                display: true,
                                text: 'Emotional Response Distribution'
                            }
                        }
                    });
                });
        });
    </script>
</body>
</html>